<?phpclass Module extends CI_Model{    function __construct()    {        parent::__construct();    }    function get_module_name($module_id)    {        $query = $this->db->get_where('modules', array('module_id' => $module_id), 1);        if ($query->num_rows() == 1)        {            $row = $query->row();            return $this->lang->line($row->name_lang_key);        }        return $this->lang->line('error_unknown');    }    function get_module_desc($module_id)    {        $query = $this->db->get_where('modules', array('module_id' => $module_id), 1);        if ($query->num_rows() == 1)        {            $row = $query->row();            return $this->lang->line($row->desc_lang_key);        }        return $this->lang->line('error_unknown');    }    function get_all_permissions()    {        $this->db->from('permissions');        return $this->db->get();    }    function get_all_subpermissions()    {        $this->db->from('permissions');        $this->db->join('modules', 'modules.module_id=permissions.module_id');        // can't quote the parameters correctly when using different operators..        $this->db->where($this->db->dbprefix('modules') . '.module_id!=', 'permission_id', FALSE);        return $this->db->get();    }    function get_all_modules()    {        $this->db->from('modules');        $this->db->order_by("sort", "asc");        return $this->db->get();    }    function get_allowed_modules($person_id)    {        $this->db->from("roles");        $this->db->join("people", "people.role_id = roles.role_id");        $this->db->where("person_id", $person_id);        $query = $this->db->get();                $rights = [];        if ( $query && $query->num_rows() > 0 )        {            $row = $query->row();            $rights = json_decode($row->rights, true);                        if ( count($rights) == 0 )            {                $rights = [""];            }        }                $this->db->from('modules');        $this->db->join('people', 'people.person_id=' . $person_id);        $this->db->join('roles', 'roles.role_id=people.role_id');        $this->db->join('plugins', 'plugins.module_name = modules.module_id', 'LEFT');                $this->db->where("person_id", $person_id);        $this->db->where_in("modules.module_id", $rights);        $this->db->where("is_active", 1);        $this->db->where("(plugins.status_flag <> 'Inactive' OR isNull(status_flag))");        $this->db->order_by("sort", "asc");        $query = $this->db->get();                return $query;    }}